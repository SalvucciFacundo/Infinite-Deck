<header class="app-header">
  <nav class="nav-container">
    <a routerLink="/" class="logo">{{ title() }}</a>

    <div class="nav-actions">
      @if (auth.currentUser(); as user) {
      <div class="user-actions">
        <app-image-uploader />
        <div class="user-profile">
          <img
            [src]="user.photoURL || 'assets/default-avatar.png'"
            [alt]="user.displayName"
            class="avatar"
          />
          <div class="user-info-mini">
            <span class="username">{{ user.displayName || user.email }}</span>
            <a routerLink="/perfil" class="link-profile">Mi Perfil</a>
          </div>
          <button (click)="auth.logout()" class="btn-logout">Salir</button>
        </div>
      </div>
      } @else {
      <button (click)="showAuthModal.set(true)" class="btn-login">Entrar / Registro</button>
      }
    </div>
  </nav>
</header>

<main class="app-main">
  <router-outlet />
</main>

@if (showAuthModal()) {
<div class="modal-overlay" (click)="showAuthModal.set(false)">
  <div class="auth-modal" (click)="$event.stopPropagation()" [formGroup]="authForm">
    <h2>{{ isRegistering() ? 'Crear cuenta' : 'Iniciar sesión' }}</h2>

    <div class="form-group">
      <label>Email</label>
      <input type="email" formControlName="email" placeholder="tu@email.com" />
    </div>

    <div class="form-group">
      <label>Contraseña</label>
      <input type="password" formControlName="password" placeholder="Mínimo 6 caracteres" />
    </div>

    @if (isRegistering()) {
    <div class="form-group">
      <label>Nombre público</label>
      <input type="text" formControlName="displayName" placeholder="Cómo te verán otros" />
    </div>
    }

    <button (click)="onSubmit()" class="btn-submit" [disabled]="authForm.invalid">
      {{ isRegistering() ? 'Registrarse' : 'Entrar' }}
    </button>

    <p class="toggle-mode">
      {{ isRegistering() ? '¿Ya tienes cuenta?' : '¿No tienes cuenta?' }}
      <a (click)="toggleAuthMode()">{{ isRegistering() ? 'Inicia sesión' : 'Regístrate aquí' }}</a>
    </p>

    <button (click)="showAuthModal.set(false)" class="btn-close">Cerrar</button>
  </div>
</div>
} @if (state.selectedImage()) {
<app-art-modal />
}
